# 동시성 테스트

## 개요

이 프로젝트는 **재고 관리 시스템에서 동시성 문제를 검증**하기 위한
예제입니다.\
여러 사용자가 동시에 재고를 차감할 때, 동시성 제어(락 등)가 적용되지
않으면 데이터 정합성 문제가 발생할 수 있습니다.

이를 검증하기 위해 여러가지 가지 API를 제공합니다:

1. **동시성 제어가 적용되지 않은 API**

------------------------------------------------------------------------

## API 명세

### 1. 재고 수 설정

``` http
POST /concurrencies/v1?stockCount={stockCount}
```

-   `stockCount` : 초기 재고 수 (기본값 `100`)

**Response**

``` json
data 에 stock 의 id 를 응답합니다.

{
  "message": "success",
  "data": 1
}
```

------------------------------------------------------------------------

### 2. 현재 남은 재고 수 조회

``` http
GET /concurrencies/{id}/v1
```

**Response**

``` json
{
  "message": "success",
  "data": 98
}
```

------------------------------------------------------------------------

### 3. 재고수 하나 씩 감소 (동시성 제어 미적용)

``` http
GET /concurrencies/{id}/no/v1
```

**Response**

``` json
{
  "message": "success"
}
```

> ⚠️ **동시성 제어가 없는 API**에서는 다중 요청 시 데이터 정합성이 깨질
> 수 있습니다.\
> (예: 100개의 요청을 보내더라도 최종 재고가 `0`이 아니라 `3` 같은 값이
> 남을 수 있음)

------------------------------------------------------------------------

### 4. 재고수 하나 씩 감소 (Redisson lock 으로 동시성 제어)

``` http
GET /concurrencies/{id}/redisson/v1
```

**Response**

``` json
{
  "message": "success"
}
```

------------------------------------------------------------------------

## 테스트 코드의 상수 설명

- **`STOCK_COUNT`**
  - 재고 수를 나타내는 값입니다.
  - 컨트롤러에서 `/concurrencies/v1` API를 통해 초기화할 수 있으며, 기본값은 `100`입니다.
  - 동시성 제어 여부에 따라 요청이 몰릴 때 감소 처리 결과가 달라질 수 있습니다.

- **`THREAD_COUNT`**
  - 재고 수를 나타내는 값입니다.
  - 동시에 실행(접속)하는 스레드 수를 나타내는 값입니다.

------------------------------------------------------------------------

## 기대 결과

-   **동시성 제어 없는 API (`/concurrencies/{id}/no/v1`)**\
    여러 요청이 동시에 들어오면 재고가 0이 되지 않고 **일부 값이 남는
    현상**이 발생합니다.

